<Window x:Class="RoSatGCS.Views.WindowOnboardScheduler"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:adonisUi="clr-namespace:AdonisUI;assembly=AdonisUI"
        xmlns:adonisExtensions="clr-namespace:AdonisUI.Extensions;assembly=AdonisUI"
        xmlns:loc="clr-namespace:RoSatGCS.Utils.Localization"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RoSatGCS.Views"
        xmlns:hex="clr-namespace:WpfHexaEditor;assembly=WPFHexaEditor"
        xmlns:ctr="clr-namespace:RoSatGCS.Controls"
        xmlns:cvt="clr-namespace:RoSatGCS.Utils.Converter"

        
        mc:Ignorable="d"
        WindowStartupLocation="CenterOwner" ResizeMode="NoResize"
        Title="WindowOnboardScheduler" Height="600" Width="600" Closing="Window_Closing">
    <Window.Resources>
        <Style TargetType="GroupBox">
            <Setter Property="Margin" Value="5,0,5,5"/>
        </Style>
        <Style x:Key="Splitter" TargetType="Rectangle">
            <Setter Property="VerticalAlignment" Value="Stretch"/>
            <Setter Property="Width" Value="1"/>
            <Setter Property="Margin" Value="3,9,3,9"/>
            <Setter Property="Stroke" Value="{DynamicResource {x:Static adonisUi:Brushes.Layer1BorderBrush}}"/>
        </Style>
        <cvt:ByteToModuleName x:Key="ByteToModuleName"/>
        <cvt:IndexInViewConverter x:Key="IndexInViewConverter"/>
        <cvt:ByteListToString x:Key="ByteListToString"/>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="300"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="34"/>
        </Grid.RowDefinitions>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="35"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="95"/>
            </Grid.RowDefinitions>
            <StackPanel Orientation="Horizontal" Margin="5,0,5,0">
                <Button Style="{DynamicResource PaneButton}" ToolTip="{loc:Localization sDeleteAll}" Command="{Binding DeleteAllCommand}">
                    <Rectangle Style="{DynamicResource Icon}" Height="10" Width="9">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{StaticResource IconTrash}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
                <Rectangle Style="{StaticResource Splitter}"/>
                <Button Style="{DynamicResource PaneButton}" ToolTip="{loc:Localization sUpdate}"
                        Command="{Binding UpdateSchedule}">
                    <Rectangle Style="{DynamicResource Icon}" Height="10" Width="10">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{StaticResource IconSync}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
                <Rectangle Style="{StaticResource Splitter}"/>
                <Button Style="{DynamicResource PaneButton}" ToolTip="{loc:Localization sErase}"
                        Command="{Binding RemoveSelectedCommand}">
                    <Rectangle Style="{DynamicResource Icon}" Height="1" Width="11">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{StaticResource IconMinus}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
                <Button Style="{DynamicResource PaneButton}" ToolTip="{loc:Localization sUp}"
                        Command="{Binding MoveCommandUp}">
                    <Rectangle Style="{DynamicResource Icon}" Height="11" Width="9">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{StaticResource IconUpward}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
                <Button Style="{DynamicResource PaneButton}" ToolTip="{loc:Localization sDown}"
                        Command="{Binding MoveCommandDown}">
                    <Rectangle Style="{DynamicResource Icon}" Height="11" Width="9">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{StaticResource IconDownward}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
                
                <Rectangle Style="{StaticResource Splitter}"/>
                <Button Style="{DynamicResource PaneButton}" ToolTip="{loc:Localization sImport}"
                        Command="{Binding Load}">
                    <Rectangle Style="{DynamicResource Icon}" Height="11" Width="9">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{StaticResource IconImport}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>


            </StackPanel>
            <GroupBox Grid.Row="1">
                <GroupBox.Header>
                    <TextBlock Text="Command List"/>
                </GroupBox.Header>
                <ListView ItemsSource="{Binding SatelliteScheduleCommandView}" SelectionMode="Single"
                          SelectedItem="{Binding SelectedCommand}" x:Name="ScheduleList">
                    <ListView.ContextMenu>
                        <ContextMenu>
                            <MenuItem Command="{Binding RemoveSelectedCommand}" Header="{loc:Localization sRemove}"/>
                        </ContextMenu>
                    </ListView.ContextMenu>
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="No." Width="30">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock>
                                            <TextBlock.Text>
                                                <MultiBinding Converter="{StaticResource IndexInViewConverter}">
                                                    <Binding />
                                                    <Binding ElementName="ScheduleList" Path="DataContext.SatelliteScheduleCommandView"/>
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="Name" Width="120">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" TextTrimming="CharacterEllipsis" ToolTip="{Binding Name}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="File" Width="90">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding File}" TextTrimming="CharacterEllipsis" ToolTip="{Binding File}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="ID" Width="45">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Id}" TextTrimming="CharacterEllipsis" ToolTip="{Binding Id}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="Target" Width="50">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Module}" TextTrimming="CharacterEllipsis" ToolTip="{Binding Module}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="Time" Width="80">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Timestamp}" TextTrimming="CharacterEllipsis" ToolTip="{Binding Timestamp}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="CP" Width="30">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox IsChecked="{Binding IsCP, Mode=OneWay}" IsEnabled="False"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="Data" Width="90">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding InputSerialized, Converter={StaticResource ByteListToString}}" 
                                                   ToolTip="{Binding InputSerialized, Converter={StaticResource ByteListToString}}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
            </GroupBox>
            
            <GroupBox Grid.Row="2">
                <GroupBox.Header>
                    <TextBlock Text="Properties"/>
                </GroupBox.Header>
                <Grid>
                    <Grid.Resources>
                        <Style TargetType="Label">
                            <Setter Property="VerticalAlignment" Value="Center"/>
                        </Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                            <Setter Property="Margin" Value="3,2,0,0"/>
                        </Style>
                    </Grid.Resources>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="30"/>
                    </Grid.RowDefinitions>
                    <StackPanel Orientation="Horizontal" Height="24">
                        <TextBlock Text="File:"/>
                        <Label Content="{Binding CommandFile}"/>
                        <Rectangle Style="{StaticResource Splitter}" Margin="3,9,3,4"/>
                        
                        <TextBlock Text="FIDL:"/>
                        <Label Content="{Binding CommandFIDLId}"/>
                        <Rectangle Style="{StaticResource Splitter}" Margin="3,9,3,4"/>
                        
                        <TextBlock Text="ID:"/>
                        <Label  Content="{Binding CommandId}"/>
                        <Rectangle Style="{StaticResource Splitter}" Margin="3,9,3,4"/>
                        
                        <TextBlock Text="Name:"/>
                        <Label  Content="{Binding CommandName}"/>
                    </StackPanel>
                    <StackPanel Grid.Row="1" Orientation="Horizontal">
                        <TextBlock Text="Target:"/>
                        <ComboBox Grid.Row="1" Height="24" Width="70" Margin="10,5,5,0" VerticalAlignment="Center"
                                  ItemsSource="{Binding CommandTargetList}" SelectedItem="{Binding CommandTarget, Mode=TwoWay}"
                                  FontSize="9" FontWeight="Medium">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Converter={StaticResource ByteToModuleName}}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        <Rectangle Style="{StaticResource Splitter}" Margin="3,9,3,4"/>
                        
                        <TextBlock Text="Time(UTC):"/>
                        <ctr:DateTimePickerSecond Height="24" Width="150" Margin="10,5,0,0" HorizontalAlignment="Right" VerticalAlignment="Top"
                                                  SelectedDate="{Binding CommandTimestamp, Mode=TwoWay}"/>
                        <Button Height="24" Margin="3,3,5,0" Content="＊" ToolTip="Zero" Command="{Binding TimestampReset}"/>
                        <Rectangle Style="{StaticResource Splitter}" Margin="3,9,3,4"/>
                        
                        <TextBlock Text="Is CP:"/>
                        <CheckBox Margin="10,3,0,0" IsChecked="{Binding CommandIsCP, Mode=TwoWay}"/>
                        <Rectangle Style="{StaticResource Splitter}" Margin="3,9,3,4"/>

                        <TextBlock Text="Param:"/>
                        <Button Height="24" Width="30" Margin="10,3,0,0" Content="..." Command="{Binding OpenCommandProperty}"/>
                    </StackPanel>
                    

                </Grid>
            </GroupBox>
        </Grid>
        
        <hex:HexEditor Grid.Row="1" BorderBrush="{DynamicResource {x:Static adonisUi:Brushes.Layer1BorderBrush}}"  BorderThickness="0,0.5,0,0.5"
                       x:Name="HexEditor" Width="Auto" Height="Auto" AllowAutoHighLightSelectionByte="False" AllowExtend="True" AppendNeedConfirmation="False" CanInsertAnywhere="True" ByteModifiedColor="AliceBlue"
                       AllowContextMenu="False" AllowZoom="False" AllowFileDrop="False" AllowTextDrop="False" BytePerLine="16" HideByteDeleted="False" OverridesDefaultStyle="True" PreloadByteInEditorMode="MaxScreenVisibleLine" StatusBarVisibility="Hidden"/>

        <StackPanel Grid.Row="2" Orientation="Horizontal" FlowDirection="RightToLeft">
            <StackPanel.Resources>
                <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                    <Setter Property="Width" Value="70"/>
                    <Setter Property="Height" Value="24"/>
                    <Setter Property="Margin" Value="10,0,0,0"/>
                </Style>
            </StackPanel.Resources>
            <Button Content="{loc:Localization sClose}" Command="{Binding Close}"/>
            <Button Content="{loc:Localization sSave}" Command="{Binding Save}"/>
            <Button Content="{loc:Localization sExport}" Command="{Binding Export}"/>
            
        </StackPanel>
    </Grid>
</Window>
