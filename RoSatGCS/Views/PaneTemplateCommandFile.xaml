<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
                    xmlns:bv="clr-namespace:RoSatGCS.Behaviors"
                    xmlns:cvt="clr-namespace:RoSatGCS.Utils.Converter"
                    xmlns:adonisUi="clr-namespace:AdonisUI;assembly=AdonisUI"
                    xmlns:loc="clr-namespace:RoSatGCS.Utils.Localization"
                    xmlns:local="clr-namespace:RoSatGCS.Views"
                    xmlns:vm="clr-namespace:RoSatGCS.ViewModels">
    <cvt:ListBoxWidthConverter x:Key="ListBoxWidthConverter"/>
    <BooleanToVisibilityConverter x:Key="BoolToVisibility" />

    
    <DataTemplate x:Key="PaneTemplateCommandFile" DataType="{x:Type vm:PaneCommandFileViewModel}">
        <Grid Margin="0,3,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="30"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Border Grid.RowSpan="2" BorderBrush="{DynamicResource {x:Static adonisUi:Brushes.Layer3BorderBrush}}" BorderThickness="0.5" Background="{DynamicResource {x:Static adonisUi:Brushes.Layer0BackgroundBrush}}"/>

            <StackPanel Margin="3" Orientation="Horizontal" Background="{DynamicResource {x:Static adonisUi:Brushes.Layer1BackgroundBrush}}" Grid.Row="0">
                <Button Style="{DynamicResource ToolButton}" Command="{Binding AddFile}" Margin="3,0,0,0">
                    <Rectangle Style="{DynamicResource Icon}">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{StaticResource IconAdd}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
            </StackPanel>
            <ListBox Grid.Row="1" Margin="3" ItemsSource="{Binding DataContext.SatelliteFunctionFileView, RelativeSource={RelativeSource AncestorType=Page}}" HorizontalAlignment="Stretch" AllowDrop="True"
                 SelectedItem="{Binding SelectedItem, Mode=TwoWay}">
                <b:Interaction.Behaviors>
                    <bv:FunctionFileListBehavior DropCommand="{Binding AddFileFromDrag}"/>
                </b:Interaction.Behaviors>
                <b:Interaction.Triggers>
                    <b:EventTrigger EventName="LostFocus">
                        <b:InvokeCommandAction Command="{Binding LostListFocus}"/>
                    </b:EventTrigger>
                </b:Interaction.Triggers>
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid Height="20" Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ListBox}, Converter={StaticResource ListBoxWidthConverter}}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="24"/>
                                <ColumnDefinition Width="24"/>
                                <ColumnDefinition Width="24"/>
                                <ColumnDefinition Width="24"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Width="Auto" Text="{Binding Name}" TextTrimming="CharacterEllipsis" Grid.Column="0" ToolTip="{Binding FilePath}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Valid}" Value="False">
                                                <Setter Property="Foreground" Value="PaleVioletRed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <ContentControl Grid.Column="1" ContentTemplate="{DynamicResource {x:Static adonisUi:Templates.LoadingCircle}}" Visibility="{Binding Initializing, Converter={StaticResource BoolToVisibility}}"
                                            Foreground="{DynamicResource {x:Static adonisUi:Brushes.ForegroundBrush}}" Width="12" Height="12"  Focusable="False"/>

                            <Button Style="{DynamicResource ToolButton}" Grid.Column="2" Command="{Binding DataContext.PaneCommandFile.RefreshFile, RelativeSource={RelativeSource AncestorType=Page}}" CommandParameter="{Binding}">
                                <Rectangle Style="{DynamicResource Icon}" ToolTip="{loc:Localization sRefresh}">
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Stretch="Fill" Visual="{StaticResource IconRefresh}" />
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                            </Button>

                            <Button Style="{DynamicResource ToolButton}" Grid.Column="3" Command="{Binding DataContext.PaneCommandFile.RemoveFile, RelativeSource={RelativeSource AncestorType=Page}}" CommandParameter="{Binding}">
                                <Rectangle Style="{DynamicResource Icon}" ToolTip="{loc:Localization sRemove}" >
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Stretch="Fill" Visual="{StaticResource IconTrash}" />
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                            </Button>

                            <Button Grid.Column="4" Style="{DynamicResource ToolButtonVisibility}">
                                <b:Interaction.Behaviors>
                                    <bv:FunctionFileVisibilityBehavior Command="{Binding DataContext.VisibilitySwap, RelativeSource={RelativeSource AncestorType=Page}}"
                                                                   CommandParameter="{Binding}"/>
                                </b:Interaction.Behaviors>
                                <ContentControl Content="{Binding Visibility}">
                                    <!--{Binding DataContext.PaneCommandFile.Visibility, RelativeSource={RelativeSource AncestorType=Page}}-->
                                    <ContentControl.ContentTemplateSelector>
                                        <local:ShowHideTemplateSelector>
                                            <local:ShowHideTemplateSelector.ShowTemplate>
                                                <DataTemplate>
                                                    <Rectangle Style="{DynamicResource Icon}" Height="8" ToolTip="{loc:Localization sHide}">
                                                        <Rectangle.OpacityMask>
                                                            <VisualBrush Stretch="Fill" Visual="{StaticResource IconShow}"/>
                                                        </Rectangle.OpacityMask>
                                                    </Rectangle>
                                                </DataTemplate>
                                            </local:ShowHideTemplateSelector.ShowTemplate>
                                            <local:ShowHideTemplateSelector.HideTemplate>
                                                <DataTemplate>
                                                    <Rectangle Style="{DynamicResource Icon}" ToolTip="{loc:Localization sShow}">
                                                        <Rectangle.OpacityMask>
                                                            <VisualBrush Stretch="Fill" Visual="{StaticResource IconHide}"/>
                                                        </Rectangle.OpacityMask>
                                                    </Rectangle>
                                                </DataTemplate>
                                            </local:ShowHideTemplateSelector.HideTemplate>
                                        </local:ShowHideTemplateSelector>
                                    </ContentControl.ContentTemplateSelector>
                                </ContentControl>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>
    </DataTemplate>
</ResourceDictionary>