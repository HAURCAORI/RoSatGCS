<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:GCSControls">
    <local:TimeSlotXConverter x:Key="TimeSlotXConverter"/>
    <local:TimeSlotYConverter x:Key="TimeSlotYConverter"/>
    <local:TimeSlotWidthConverter x:Key="TimeSlotWidthConverter"/>
    <Style x:Key="SlotButtonStyle" TargetType="{x:Type Button}">
        <Style.Setters>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Stretch"/>
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0.5"/>
            <Setter Property="Padding" Value="0" />
        </Style.Setters>
    </Style>
    <Style TargetType="{x:Type local:TimeSlots}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:TimeSlots}">
                    <Border Background="{TemplateBinding Background}"
                         BorderBrush="{TemplateBinding BorderBrush}"
                         BorderThickness="{TemplateBinding BorderThickness}">
                        <Grid Background="Transparent">
                            <Canvas ClipToBounds="True"> 
                                <ItemsControl ItemsSource="{Binding TimeSlotItems, RelativeSource={RelativeSource TemplatedParent}}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Style="{StaticResource SlotButtonStyle}">
                                                <ContentControl Content="{Binding Priority}" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch">
                                                    <ContentControl.ContentTemplateSelector>
                                                        <local:TimeSlotTemplateSelector>
                                                            <local:TimeSlotTemplateSelector.PriorityHighTemplate>
                                                                <DataTemplate>
                                                                    <Rectangle Height="20">
                                                                        <Rectangle.Fill>
                                                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                                <GradientStop Color="#80FF6666" Offset="0.0"/>
                                                                                <GradientStop Color="#80FF4444" Offset="0.5"/>
                                                                                <GradientStop Color="#80FF6666" Offset="1.0"/>
                                                                            </LinearGradientBrush>
                                                                        </Rectangle.Fill>
                                                                    </Rectangle>
                                                                </DataTemplate> 
                                                            </local:TimeSlotTemplateSelector.PriorityHighTemplate>
                                                            <local:TimeSlotTemplateSelector.PriorityMidTemplate>
                                                                <DataTemplate>
                                                                    <Rectangle Height="20">
                                                                        <Rectangle.Fill>
                                                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                                <GradientStop Color="#8090EE90" Offset="0.0"/>
                                                                                <GradientStop Color="#8080DE80" Offset="0.5"/>
                                                                                <GradientStop Color="#8090EE90" Offset="1.0"/>
                                                                            </LinearGradientBrush>
                                                                        </Rectangle.Fill>
                                                                    </Rectangle>
                                                                </DataTemplate>
                                                            </local:TimeSlotTemplateSelector.PriorityMidTemplate>
                                                            <local:TimeSlotTemplateSelector.PriorityLowTemplate>
                                                                <DataTemplate>
                                                                    <Rectangle Height="20">
                                                                        <Rectangle.Fill>
                                                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                                <GradientStop Color="#80FFD700" Offset="0.0"/>
                                                                                <GradientStop Color="#80FFF000" Offset="0.5"/>
                                                                                <GradientStop Color="#80FFD700" Offset="1.0"/>
                                                                            </LinearGradientBrush>
                                                                        </Rectangle.Fill>
                                                                    </Rectangle>
                                                                </DataTemplate>
                                                            </local:TimeSlotTemplateSelector.PriorityLowTemplate>
                                                        </local:TimeSlotTemplateSelector>
                                                    </ContentControl.ContentTemplateSelector>
                                                </ContentControl>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>

                                    <ItemsControl.ItemContainerStyle>
                                        <Style TargetType="ContentPresenter">
                                            <Setter Property="Canvas.Left">
                                                <Setter.Value>
                                                    <MultiBinding Converter="{StaticResource TimeSlotXConverter}">
                                                        <Binding Path="StartTime" Mode="OneWay" UpdateSourceTrigger="PropertyChanged"/>
                                                        <Binding Path="TimeLineStart" RelativeSource="{RelativeSource AncestorType=local:TimeSlots}" Mode="OneWay" UpdateSourceTrigger="PropertyChanged"/>
                                                        <Binding Path="TimeLineEnd" RelativeSource="{RelativeSource AncestorType=local:TimeSlots}" Mode="OneWay" UpdateSourceTrigger="PropertyChanged"/>
                                                        <Binding Path="ActualWidth" RelativeSource="{RelativeSource AncestorType=local:TimeSlots}" Mode="OneWay" UpdateSourceTrigger="PropertyChanged"/>
                                                    </MultiBinding>
                                                </Setter.Value>
                                            </Setter>
                                            <Setter Property="Canvas.Top">
                                                <Setter.Value>
                                                    <MultiBinding Converter="{StaticResource TimeSlotYConverter}">
                                                        <Binding Path="." Mode="OneWay" UpdateSourceTrigger="PropertyChanged"/>
                                                        <Binding Path="TimeSlotItems" RelativeSource="{RelativeSource AncestorType=local:TimeSlots}" Mode="OneWay" UpdateSourceTrigger="PropertyChanged"/>
                                                        <Binding Path="VerticalOffset" RelativeSource="{RelativeSource AncestorType=local:TimeSlots}" Mode="OneWay" UpdateSourceTrigger="PropertyChanged"/>
                                                    </MultiBinding>
                                                </Setter.Value>
                                            </Setter>
                                            <Setter Property="Width">
                                                <Setter.Value>
                                                    <MultiBinding Converter="{StaticResource TimeSlotWidthConverter}">
                                                        <Binding Path="StartTime" Mode="OneWay" UpdateSourceTrigger="PropertyChanged"/>
                                                        <Binding Path="EndTime" Mode="OneWay" UpdateSourceTrigger="PropertyChanged"/>
                                                        <Binding Path="TimeLineStart" RelativeSource="{RelativeSource AncestorType=local:TimeSlots}" Mode="OneWay" UpdateSourceTrigger="PropertyChanged"/>
                                                        <Binding Path="TimeLineEnd" RelativeSource="{RelativeSource AncestorType=local:TimeSlots}" Mode="OneWay" UpdateSourceTrigger="PropertyChanged"/>
                                                        <Binding Path="ActualWidth" RelativeSource="{RelativeSource AncestorType=local:TimeSlots}" Mode="OneWay" UpdateSourceTrigger="PropertyChanged"/>
                                                    </MultiBinding>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ItemsControl.ItemContainerStyle>
                                    
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <Canvas />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                </ItemsControl>
                            </Canvas>
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>